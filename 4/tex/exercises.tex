\documentclass[11pt]{article}

\usepackage{listings}
\lstset{basicstyle=\ttfamily\footnotesize}
\lstset{literate={~} {$\sim$}{1}}
\lstset{showstringspaces=false}
\lstset{language=Python}
\usepackage{scrextend}
\newcommand{\linp}[1]{\lstinputlisting{#1}{}}
\newcommand{\linl}[1]{\lstinline{#1}{}}

\usepackage[cm]{fullpage}
\usepackage{mathtools} %includes amsmath
\usepackage{amsfonts}
\usepackage{bm}
\usepackage{url}
%greek letters
\renewcommand{\a}{\alpha}    %alpha
\renewcommand{\b}{\beta}     %beta
\newcommand{\g}{\gamma}      %gamma
\newcommand{\G}{\Gamma}      %Gamma
\renewcommand{\d}{\delta}    %delta
\newcommand{\D}{\Delta}      %Delta
\newcommand{\e}{\varepsilon} %epsilon
\newcommand{\ev}{\epsilon}   %epsilon*
\newcommand{\z}{\zeta}       %zeta
\newcommand{\h}{\eta}        %eta
\renewcommand{\th}{\theta}   %theta
\newcommand{\Th}{\Theta}     %Theta
\newcommand{\io}{\iota}      %iota
\renewcommand{\k}{\kappa}    %kappa
\newcommand{\la}{\lambda}    %lambda
\newcommand{\La}{\Lambda}    %Lambda
\newcommand{\m}{\mu}         %mu
\newcommand{\n}{\nu}         %nu %xi %Xi %pi %Pi
\newcommand{\p}{\rho}        %rho
\newcommand{\si}{\sigma}     %sigma
\newcommand{\siv}{\varsigma} %sigma*
\newcommand{\Si}{\Sigma}     %Sigma
\renewcommand{\t}{\tau}      %tau
\newcommand{\up}{\upsilon}   %upsilon
\newcommand{\f}{\phi}        %phi
\newcommand{\F}{\Phi}        %Phi
\newcommand{\x}{\chi}        %chi
\newcommand{\y}{\psi}        %psi
\newcommand{\Y}{\Psi}        %Psi
\newcommand{\w}{\omega}      %omega
\newcommand{\W}{\Omega}      %Omega
%ornaments
\newcommand{\eth}{\ensuremath{^\text{th}}}
\newcommand{\rst}{\ensuremath{^\text{st}}}
\newcommand{\ond}{\ensuremath{^\text{nd}}}
\newcommand{\ord}[1]{\ensuremath{^{(#1)}}}
\newcommand{\dg}{\ensuremath{^\dagger}}
\newcommand{\bigo}{\ensuremath{\mathcal{O}}}
\newcommand{\tl}{\ensuremath{\tilde}}
\newcommand{\ol}[1]{\ensuremath{\overline{#1}}}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\op}[1]{\ensuremath{\hat{#1}}}
\newcommand{\ot}{\ensuremath{\otimes}}
\newcommand{\wg}{\ensuremath{\wedge}}
%text
\newcommand{\tr}{\ensuremath{\hspace{1pt}\mathrm{tr}\hspace{1pt}}}
\newcommand{\Alt}{\ensuremath{\mathrm{Alt}}}
\newcommand{\sgn}{\ensuremath{\mathrm{sgn}}}
\newcommand{\occ}{\ensuremath{\mathrm{occ}}}
\newcommand{\vir}{\ensuremath{\mathrm{vir}}}
\newcommand{\spn}{\ensuremath{\mathrm{span}}}
\newcommand{\vac}{\ensuremath{\mathrm{vac}}}
\newcommand{\bs}{\ensuremath{\text{\textbackslash}}}
\newcommand{\im}{\ensuremath{\mathrm{im}\hspace{1pt}}}
\renewcommand{\sp}{\hspace{30pt}}
%dots
\newcommand{\ld}{\ensuremath{\ldots}}
\newcommand{\cd}{\ensuremath{\cdots}}
\newcommand{\vd}{\ensuremath{\vdots}}
\newcommand{\dd}{\ensuremath{\ddots}}
\newcommand{\etc}{\ensuremath{\mathinner{\mkern-1mu\cdotp\mkern-2mu\cdotp\mkern-2mu\cdotp\mkern-1mu}}}
%fonts
\newcommand{\bmit}[1]{{\bfseries\itshape\mathversion{bold}#1}}
\newcommand{\mc}[1]{\ensuremath{\mathcal{#1}}}
\newcommand{\mb}[1]{\ensuremath{\mathbb{#1}}}
\newcommand{\mf}[1]{\ensuremath{\mathfrak{#1}}}
\newcommand{\mr}[1]{\ensuremath{\mathrm{#1}}}
\newcommand{\bo}[1]{\ensuremath{\mathbf{#1}}}
%styles
\newcommand{\ts}{\textstyle}
\newcommand{\ds}{\displaystyle}
\newcommand{\phsub}{\ensuremath{_{\phantom{p}}}}
\newcommand{\phsup}{\ensuremath{^{\phantom{p}}}}
%fractions, derivatives, parentheses, brackets, etc.
\newcommand{\pr}[1]{\ensuremath{\left(#1\right)}}
\newcommand{\brk}[1]{\ensuremath{\left[#1\right]}}
\newcommand{\fr}[2]{\ensuremath{\dfrac{#1}{#2}}}
\newcommand{\pd}[2]{\ensuremath{\frac{\partial#1}{\partial#2}}}
\newcommand{\fd}[2]{\ensuremath{\frac{d #1}{d #2}}}
\newcommand{\pt}{\ensuremath{\partial}}
\newcommand{\br}[1]{\ensuremath{\langle#1|}}
\newcommand{\kt}[1]{\ensuremath{|#1\rangle}}
\newcommand{\ip}[1]{\ensuremath{\langle#1\rangle}}
\newcommand{\NO}[1]{\ensuremath{{\bm{:}}#1{}{\bm{:}}}}
\usepackage{stackengine}
\newcommand{\GNO}[1]{\setstackgap{S}{0.7pt}\ensuremath{\Shortstack{\textbf{.} \textbf{.} \textbf{.}}#1\Shortstack{\textbf{.} \textbf{.} \textbf{.}}}}
\newcommand{\cmtr}[2]{\ensuremath{[\cdot,#2]^{#1}}}
\newcommand{\cmtl}[2]{\ensuremath{[#2,\cdot]^{#1}}}
\newcommand{\floor}[1]{\ensuremath{\left\lfloor#1\right\rfloor}}
\newcommand{\ceil}[1]{\ensuremath{\left\lceil#1\right\rceil}}
%structures
\newcommand{\eqn}[1]{(\ref{#1})}
\newcommand{\ma}[1]{\ensuremath{\begin{bmatrix}#1\end{bmatrix}}}
\newcommand{\ar}[1]{\ensuremath{\begin{matrix}#1\end{matrix}}}
\newcommand{\miniar}[1]{\ensuremath{\begin{smallmatrix}#1\end{smallmatrix}}}

\title{Programming Project 4 Exercises}
\author{}
\date{}

\begin{document}

\maketitle

\begin{enumerate}
  % PROBLEM 1
  \item
  Given a basis of Hartree-Fock spin-orbitals $\{\y_p\}$, the MP2 correlation energy has the following form.
\begin{equation}
  \label{spin-orbital-mp2-energy}
  E\ord{2}
=
  \fr{1}{4}
  \sum_{ijab}
  \fr{|\ip{\y_i\y_j||\y_a\y_b}|^2}{\ev_i+\ev_j-\ev_a-\ev_b}
\end{equation}
  For a closed-shell system these spin-MOs come in $\a$, $\b$ pairs
\begin{align}
&
  \y_{2P-1}(\bo{r}, s) = \f_P(\bo{r})\a(s)
&&
  \y_{2P}(\bo{r}, s) = \f_P(\bo{r})\b(s)
\end{align}
  where the index $P$ runs over spatial MOs $\{\f_P\}$.
  Expand equation \ref{spin-orbital-mp2-energy} in this basis, perform the spin-integration, and combine like terms to show that
\begin{equation}
  E\ord{2}
=
  \sum_{IJAB}
  \fr{\ip{\f_I\f_J|\f_A\f_B}\pr{\ip{\f_I\f_J|\f_A\f_B} - \ip{\f_I\f_J|\f_B\f_A}}}
     {\ev_I+\ev_J-\ev_A-\ev_B}
\end{equation}
  is the MP2 correlation energy for an RHF reference.
  % PROBLEM 2
  \item
  The most expensive step in an MP2 code is the transformation of two-electron integrals from the AO basis $\{\x_\mu\}$ to the MO basis $\{\f_\mu\}$.
  Assuming $C_{\mu P}$ are the MO expansion coefficients 
\begin{equation}
  \f_P
=
  \sum_{\mu} \x_\mu C_{\mu P}
\end{equation}
  show that this transformation is given by the following equation.
\begin{equation}
  \ip{\f_I\f_J|\f_A\f_B}
=
  \sum_{\mu\nu\rho\si}
  \ip{\x_\mu\x_\nu|\x_\rho\x_\si}
  C_{\mu I}^*C_{\nu J}^* C_{\rho A} C_{\si B}
\end{equation}
  The most straight-forward algorithm for implementing this transformation is
\begin{lstlisting}
g = zeros((nocc, nocc, nvir, nvir))

for I in occupied
  for J in occupied
    for A in virtual
      for B in virtual
        for mu in ao_basis
          for nu in ao_basis
            for rh in ao_basis
              for si in ao_basis
                g[I,J,A,B] += G[mu,nu,rh,si] * C[mu,I] * C[nu,J] * C[rh,A] * C[si,B]
\end{lstlisting}
  which scales as $n_{\mr{o}}^2n_{\mr{v}}^2n_{\mr{b.f.}}^4$ with the number of occupied orbitals ($n_o$), the number of virtual orbitals ($n_v$), and the number of AO basis functions ($n_{\mr{b.f.}}$).
  Define the term ``scaling'' and expalin how the scaling factor for this algorithm was derived.\\
  A substantially more efficient algorithm breaks this transformation down into a series of four partial AO$\rightarrow$MO transformations.
\begin{equation}
  \ip{\f_I\f_J|\f_A\f_B}
=
  \pr{
    \sum_\si
    \pr{
      \sum_\rho
      \pr{
        \sum_\nu
        \pr{
          \sum_\mu
          \ip{\x_\mu\x_\nu|\x_\rho\x_\si}
          C_{\mu I}^*
        }
        C_{\nu J}^*
      }
      C_{\rho A}
    } 
    C_{\si B}
  }
\end{equation}
  Write out the pseudo-code for all four steps of this algorithm and identify the scaling factor for each one.
  Identify which step(s) are bottlenecks for large basis sets.
  Explain why the first algorithm scales as $n_{\mr{b.f.}}^6$ with increasing basis set size whereas the second algorithm scales as $n_{\mr{b.f.}}^5$ with increasing basis set size, holding the number of electrons constant.


\end{enumerate}


\end{document}
